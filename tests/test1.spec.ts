import { test, expect } from '@playwright/test';
import { dmlocators, DMpage_Locators } from '../utils/dmlocators';
import { getAppCredentials } from '../utils/dbUtils';

test('test', async ({ page }) => {
  const chat = new dmlocators(page);
const config = await getAppCredentials('test_auto');
  await page.goto(config.appUrl);
  await page.getByLabel('Application ID *').click();
  await page.getByLabel('Application ID *').fill(config.appId);
  await page.locator('button').click();
  await page.getByRole('textbox', { name: 'Email address' }).click();
  await page.fill('#username', config.appUser); 
  await page.fill('#password', config.appPass);
  await page.getByRole('button', { name: 'Continue', exact: true }).click();
  await chat.clickProjDropdown();
  await page.getByText('Sports Alpha - NHL').click();
  await page.locator('.drawer-handle > .react-autoql-icon > svg').click();
  await page.getByRole('button', { name: 'Player moving average' }).click();
  await page.locator('.query-suggestion-send-btn > .react-autoql-icon > svg').click();
  await page.locator('.react-autoql-toolbar.options-toolbar > button:nth-child(2)').click();
  await page.locator('[data-test="react-autoql-checkbox"]').first().check();
  await page.getByRole('button', { name: 'Apply' }).click();
  await page.locator('div').filter({ hasText: /^Scrolled 50 \/ 50,000\+ rows$/ }).nth(1).click();
  await chat.clickPlusIcon();
  await chat.clickCustomButton();
  await page.getByRole('textbox', { name: 'eg. "Difference"' }).fill('Rank');
  await page.getByRole('button', { name: 'Rank' }).click();
  await page.locator('[data-test="react-autoql-select"]').first().click();
  await page.locator('.scrollbar-container.react-autoql-custom-scrollbars.always-visible > .ps__rail-y').click();
  await page.locator('span').filter({ hasText: 'Team' }).first().click();
  await page.locator('div').filter({ hasText: /^None$/ }).click();
  await page.locator('.scrollbar-container.react-autoql-custom-scrollbars.always-visible > .ps__rail-y > .ps__thumb-y').click();
  await page.locator('.scrollbar-container.react-autoql-custom-scrollbars.always-visible > .ps__rail-y > .ps__thumb-y').click();
  await page.locator('span').filter({ hasText: /^Goals$/ }).click();
  await page.getByText('Select an item').click();
  await page.getByText('DESCENDING').click();
  await page.getByRole('button', { name: 'Add Function' }).click();
  await page.getByRole('button', { name: 'Save Column' }).click();
  await page.locator('div').filter({ hasText: /^Scrolled 50 \/ 50,000\+ rows$/ }).nth(1).click();
  await page.locator('.react-autoql-toolbar.options-toolbar > button:nth-child(2)').click();
  await page.locator('[data-test="react-autoql-checkbox"]').first().uncheck();
  await page.locator('[data-test="react-autoql-checkbox"]').nth(2).check();
  await page.locator('[data-test="react-autoql-checkbox"]').nth(5).check();
 const scrollContainer = page.locator("xpath=//*[@class='react-autoql-modal-body ']");
 await scrollContainer.evaluate((el) => {
    el.scrollTop = el.scrollHeight;
});
  await page.locator('[id="2668ae46-838f-4380-baf7-8c9c38f97b21"]').check();
  await page.getByRole('button', { name: 'Apply' }).click();
  await page.getByText('Goals', { exact: true }).click();
  await page.locator('[data-test="react-autoql-table"]').getByText('Goals', { exact: true }).click();
});